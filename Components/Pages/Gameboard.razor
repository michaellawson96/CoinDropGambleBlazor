@page "/"
@using System.ComponentModel
@using Microsoft.AspNetCore.Components;
@using CoinDropGamble.Models.Enums
@using CoinDropGamble.Helpers
@rendermode InteractiveServer

<PageTitle>Coin Drop Gamble</PageTitle>

@if (!_isGameStarted)
{
    <IntroCard OnStartGame="StartGameButtonPressed" />
}
else
{
    <div class="flex flex-column justify-content-center align-items-center vh-25 py-2 background">
    <div class="row g-4">
        <!-- Capacity Section on top of image section -->
        <div class="col-lg-4 d-flex flex-column">
            <div class="card text-center text-white bg-dark shadow-lg section-card flex-fill">
                <div class="card-body capacity-section">
                    <h3 class="card-title">BETWEEN @(_piggyBankCapacity-_lowerDisparity) AND @(_piggyBankCapacity + _higherDisparity)</h3>
                </div>
            </div>
            <div class="card text-center text-white bg-dark shadow-lg section-card flex-fill image-section">
                <img src="@_imagePath" class="card bg-dark"/>
            </div>
        </div>

        <!-- Description Section -->
        <div class="col-lg-8 d-flex flex-column">
            <div class="card text-center text-white bg-dark shadow-lg section-card flex-fill">
                <div class="card-body description-section">
                    @if(_dialogList.Any()){
                        <p class="card-text">@_dialogList[0].line1</p>
                        <p class="card-text"> @_dialogList[0].line2</p>
                        <button class="btn btn-primary flashing-button" @onclick="ProgressDialogStream">Continue</button>
                    }
                    else if (_dialog.line1 is not null)
                    {
                        <p class="card-text">@_dialog.line1</p>
                        <p class="card-text"> @_dialog.line2</p>
                    }
                    
                </div>
            </div>
        </div>
    </div>
</div>

<div class="flex flex-column justify-content-center align-items-center vh-50 py-2 background">
    <div class="row g-4">
        <!-- Action Section -->
        <div class="col-6 d-flex flex-column">
            <div class="card text-center text-white bg-dark shadow-lg section-card flex-fill">
                <div class="card-body action-section">
                    <div class="row">
                        <!-- Drop Coin Action -->
                        <button 
                            class="btn btn-primary btn-lg col-12 my-1" 
                            disabled="@(_isPlayerCoinDisabled || _isPlayerControlsDisabled || (_playerPlayedCoinsCount == MAX_COINS_PLAYABLE))" 
                            @onclick="PlayerDropCoinAction">
                            @* Render the coins*@
                            @for (int i = 0; i < MAX_COINS_PLAYABLE; i++)
                            {
                                <i class="bi @(i < _playerPlayedCoinsCount ? "bi-dash-circle-dotted text-secondary" : "bi-coin text-warning") me-1"></i>
                            }
                        </button>
                        <!-- Shake Action -->
                        <button class="btn btn-success btn-lg col-12 my-1 " disabled="@(_isPlayerShakeDisabled || _hasPlayerShakenThisRound || _isPlayerControlsDisabled)" @onclick="PlayerShakeAction">Shake</button>
                        <!-- Special Action -->
                        <button class="btn btn-warning btn-lg col-12  my-1 " disabled="@(_isPlayerSpecialDisabled || !_playerSpecialCoins.Any() || _isPlayerControlsDisabled)" @onclick="SpecialAction">Special</button>
                        <!-- End Turn Action -->
                        <button class="btn btn-danger btn-lg col-12  my-1 " disabled="@(_isPlayerEndTurnDisabled || !_hasPlayerActedThisTurn || _isPlayerControlsDisabled )" @onclick="EndTurnAction">End Turn</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Status Section -->
        <div class="col-6 d-flex flex-column">
            <div class="card text-center text-white bg-dark shadow-lg section-card flex-fill">
                <div class="card-body status-section">
                    
                    <p class="card-text">
                        PLAYER
                        @if(_isPlayersTurn)
                        {
                            <span class="badge rounded-pill bg-success">Your Turn</span>
                        }
                    </p>
                    <p class="card-text">
                        @for (int i = 0; i < _currentGameMaxHealth; i++)
                        {
                            if (i < _playerHealthCount)
                            {
                                <i class="bi bi-heart-fill text-danger"></i> <!-- Filled heart for health left -->
                            }
                            else
                            {
                                <i class="bi bi-heart text-danger"></i> <!-- Empty heart for health lost -->
                            }
                        }

                        &nbsp;$ @_playerPocketMoneyCount
                    </p>
                    <p class="card-text">Games Won: @_gamesWon</p>
                    <hr>
                    <p class="card-text">
                        OPPONENT
                        @if(_isOpponentsTurn)
                        {
                            <span class="badge rounded-pill bg-success">Your Turn</span>
                        }
                    </p>
                    <p class="card-text">
                        @for (int i = 0; i < _currentGameMaxHealth; i++)
                        {
                            if (i < _opponentHealthCount)
                            {
                                <i class="bi bi-heart-fill text-danger"></i> <!-- Filled heart for health left -->
                            }
                            else
                            {
                                <i class="bi bi-heart text-danger"></i> <!-- Empty heart for health lost -->
                            }
                        }

                        &nbsp;$ @_opponentPocketMoneyCount
                    </p>
                    
                </div>
            </div>
        </div>
    </div>
</div>


}
